<!-- Notification Toast -->
@if (notification(); as notif) {
<div class="fixed right-6 top-6 z-50 animate-slide-in-right">
    <div class="flex items-center gap-3 rounded-xl border-l-4 px-5 py-4 shadow-elevated backdrop-blur-sm" [ngClass]="{
        'border-success bg-success/10': notif.type === 'success',
        'border-danger bg-danger/10': notif.type === 'error'
      }">
        <svg class="h-5 w-5"
            [ngClass]="{'text-success': notif.type === 'success', 'text-danger': notif.type === 'error'}"
            xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            @if (notif.type === 'success') {
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            } @else {
            <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
            }
        </svg>
        <div>
            <p class="text-sm font-semibold"
                [ngClass]="{'text-success': notif.type === 'success', 'text-danger': notif.type === 'error'}">
                {{ notif.type === 'success' ? 'Success' : 'Error' }}
            </p>
            <p class="text-sm text-neutral-dark">{{ notif.message }}</p>
        </div>
    </div>
</div>
}

<div class="rounded-2xl border border-white/60 bg-white/95 shadow-card">
    <!-- Header -->
    <div class="flex flex-col gap-4 border-b border-neutral-200 p-6 sm:flex-row sm:items-center sm:justify-between">
        <div>
            <h2 class="text-lg font-semibold text-neutral-dark">Fleet Management</h2>
            <p class="mt-1 text-sm text-neutral">Manage your rental car inventory</p>
        </div>
        <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
            <!-- Search -->
            <div class="relative">
                <svg class="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-neutral"
                    xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"
                    stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                </svg>
                <input type="text" placeholder="Search cars..." [ngModel]="searchQuery()"
                    (ngModelChange)="searchQuery.set($event)"
                    class="w-full rounded-lg border border-neutral-200 bg-white py-2 pl-10 pr-4 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/20 sm:w-64" />
            </div>
            <!-- Add Button -->
            <button (click)="openModal('new')"
                class="inline-flex items-center justify-center gap-2 rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition-all hover:bg-primary-700 hover:shadow-md">
                <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Add Car
            </button>
        </div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="flex items-center justify-center py-12">
        <div class="h-8 w-8 animate-spin rounded-full border-4 border-primary border-t-transparent"></div>
    </div>
    } @else {
    <!-- Cards Grid -->
    <div class="grid gap-4 p-6 sm:grid-cols-2 lg:grid-cols-3">
        @for (car of filteredCars; track car.carId) {
        <div
            class="group overflow-hidden rounded-xl border border-neutral-200 bg-white shadow-soft transition-all hover:shadow-card">
            <!-- Car Image -->
            <div class="relative h-40 overflow-hidden bg-neutral-100">
                @if (car.carImage) {
                <img [src]="car.carImage" [alt]="car.brand + ' ' + car.model"
                    class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105" />
                } @else {
                <div class="flex h-full items-center justify-center">
                    <svg class="h-16 w-16 text-neutral-300" xmlns="http://www.w3.org/2000/svg" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h.375a.375.375 0 00.375-.375M21 12a2.25 2.25 0 00-2.25-2.25H15" />
                    </svg>
                </div>
                }
                <!-- Rate Badge -->
                <div
                    class="absolute right-2 top-2 rounded-lg bg-neutral-dark/80 px-2.5 py-1 text-xs font-semibold text-white backdrop-blur-sm">
                    {{ formatCurrency(car.dailyRate) }}/day
                </div>
            </div>

            <!-- Car Details -->
            <div class="p-4">
                <div class="flex items-start justify-between">
                    <div>
                        <h3 class="font-semibold text-neutral-dark">{{ car.brand }} {{ car.model }}</h3>
                        <p class="mt-0.5 text-sm text-neutral">{{ car.year }} · {{ car.color }}</p>
                    </div>
                </div>

                <div class="mt-3 flex items-center gap-2 text-xs text-neutral">
                    <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5zm6-10.125a1.875 1.875 0 11-3.75 0 1.875 1.875 0 013.75 0zm1.294 6.336a6.721 6.721 0 01-3.17.789 6.721 6.721 0 01-3.168-.789 3.376 3.376 0 016.338 0z" />
                    </svg>
                    <span class="font-medium">{{ car.regNo }}</span>
                </div>

                <!-- Actions -->
                <div class="mt-4 flex items-center gap-2 border-t border-neutral-100 pt-4">
                    <button (click)="openModal('edit', car)"
                        class="flex-1 rounded-lg border border-neutral-200 bg-white px-3 py-2 text-sm font-medium text-neutral-dark transition-colors hover:bg-neutral-50">
                        Edit
                    </button>
                    <button (click)="deleteCar(car)"
                        class="rounded-lg border border-danger/20 bg-danger/5 px-3 py-2 text-sm font-medium text-danger transition-colors hover:bg-danger/10">
                        <svg class="h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        } @empty {
        <div class="col-span-full py-12 text-center">
            <svg class="mx-auto h-12 w-12 text-neutral-300" xmlns="http://www.w3.org/2000/svg" fill="none"
                viewBox="0 0 24 24" stroke="currentColor" stroke-width="1">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M8.25 18.75a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 01-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m3 0h.375a.375.375 0 00.375-.375M21 12a2.25 2.25 0 00-2.25-2.25H15" />
            </svg>
            <p class="mt-4 text-sm font-medium text-neutral-dark">No cars found</p>
            <p class="mt-1 text-sm text-neutral">Get started by adding a new car to the fleet.</p>
        </div>
        }
    </div>
    }
</div>

<!-- Modal -->
@if (modalOpen()) {
<div
    class="fixed inset-0 z-50 flex items-center justify-center overflow-y-auto bg-neutral-dark/50 p-4 backdrop-blur-sm">
    <div class="relative w-full max-w-lg animate-scale-in rounded-2xl bg-white shadow-elevated">
        <!-- Modal Header -->
        <div class="flex items-center justify-between border-b border-neutral-200 p-6">
            <h3 class="text-lg font-semibold text-neutral-dark">
                {{ isEditing() ? 'Edit Car' : 'Add New Car' }}
            </h3>
            <button (click)="closeModal()"
                class="rounded-lg p-2 text-neutral transition-colors hover:bg-neutral-100 hover:text-neutral-dark">
                <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Modal Body -->
        <form (ngSubmit)="saveCar()" class="p-6">
            <div class="space-y-4">
                <!-- Brand & Model -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="brand" class="mb-1.5 block text-sm font-medium text-neutral-dark">Brand</label>
                        <input type="text" id="brand" name="brand" [(ngModel)]="activeCar.brand" required
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., Toyota" />
                    </div>
                    <div>
                        <label for="model" class="mb-1.5 block text-sm font-medium text-neutral-dark">Model</label>
                        <input type="text" id="model" name="model" [(ngModel)]="activeCar.model" required
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., Camry" />
                    </div>
                </div>

                <!-- Year & Color -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="year" class="mb-1.5 block text-sm font-medium text-neutral-dark">Year</label>
                        <input type="number" id="year" name="year" [(ngModel)]="activeCar.year" required min="2000"
                            max="2030"
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., 2024" />
                    </div>
                    <div>
                        <label for="color" class="mb-1.5 block text-sm font-medium text-neutral-dark">Color</label>
                        <input type="text" id="color" name="color" [(ngModel)]="activeCar.color"
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., Midnight Black" />
                    </div>
                </div>

                <!-- Daily Rate & Reg No -->
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="dailyRate" class="mb-1.5 block text-sm font-medium text-neutral-dark">Daily Rate
                            (₹)</label>
                        <input type="number" id="dailyRate" name="dailyRate" [(ngModel)]="activeCar.dailyRate" required
                            min="0"
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., 4500" />
                    </div>
                    <div>
                        <label for="regNo" class="mb-1.5 block text-sm font-medium text-neutral-dark">Registration
                            No</label>
                        <input type="text" id="regNo" name="regNo" [(ngModel)]="activeCar.regNo" required
                            class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                            placeholder="e.g., MH12AB1234" />
                    </div>
                </div>

                <!-- Car Image URL -->
                <div>
                    <label for="carImage" class="mb-1.5 block text-sm font-medium text-neutral-dark">Image URL</label>
                    <input type="url" id="carImage" name="carImage" [(ngModel)]="activeCar.carImage"
                        class="block w-full rounded-lg border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-dark placeholder:text-neutral focus:border-primary focus:bg-white focus:outline-none focus:ring-2 focus:ring-primary/20"
                        placeholder="https://example.com/car-image.jpg" />
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="mt-6 flex items-center justify-end gap-3">
                <button type="button" (click)="closeModal()"
                    class="rounded-lg border border-neutral-200 bg-white px-4 py-2 text-sm font-medium text-neutral-dark transition-colors hover:bg-neutral-50">
                    Cancel
                </button>
                <button type="submit"
                    class="rounded-lg bg-primary px-4 py-2 text-sm font-semibold text-white shadow-sm transition-all hover:bg-primary-700 hover:shadow-md">
                    {{ isEditing() ? 'Update Car' : 'Add Car' }}
                </button>
            </div>
        </form>
    </div>
</div>
}